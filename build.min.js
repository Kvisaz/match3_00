function Pool(e,t){this.freeAmount=0,this.objects=[],this.add=function(e){this.objects[this.freeAmount++]=e};for(var i=0;i<e;i++)this.add(t());this.get=function(){var e=null;return this.freeAmount>0?(this.freeAmount--,e=this.objects[this.freeAmount],this.objects[this.freeAmount]=null):e=t(),e},this.free=function(e){-1==this.objects.indexOf(e)&&this.add(e)}}function Swipe(e){this.started=!1,this.directions=Directions,this.SENS_DISTANCE=e,this.distance={x:0,y:0,total:0},this.direction=this.directions.NONE}function myAsyncTest(){async1()}function async1(){console.log("async1 func"),setTimeout(async2,1e3)}function async2(){console.log("async2 func"),setTimeout(async3,1e3)}function async3(){console.log("async3 func"),setTimeout(result,1e3)}function result(){console.log("result func")}function myAsyncTest_1(){(new AsyncChain).add(async1_1).add(async2_1).add(async3_1).add(function(e,t){console.log("custom func arg1 = "+t),setTimeout(e.getNext("Hello, RESULT"),2e3)}).add(result).onError(function(e){alert(e)}).start()}function AsyncChain(){this.index=0,this.callbacks=[],this.onErrorData={callback:function(e){console.log("onError: "+e.name)},context:void 0}}function async1_1(e){console.log("async1_1 func"),setTimeout(e.getNext("Hello, next func"),1e3)}function async2_1(e,t,i){console.log("async2_1 func"),console.log("arg1 = "+t+" arg2 ="+i),setTimeout(e.getNext(1e3,2e3),1e3)}function async3_1(e,t,i){console.log("async3_1 func"),console.log("arg1 = "+t+" arg2 ="+i),setTimeout(e.getNext(314),1e3)}function result_1(e,t){console.log("result func"),console.log("arg1 = "+t)}function myAsyncTest(){async1()}function async1(){console.log("async1 func"),setTimeout(async2,1e3)}function async2(){console.log("async2 func"),setTimeout(async3,1e3)}function async3(){console.log("async3 func"),setTimeout(result,1e3)}function result(){console.log("result func")}function myAsyncTest_1(){(new AsyncChain).add(async1_1).add(async2_1).add(async3_1).add(function(e,t){console.log("custom func arg1 = "+t),setTimeout(e.getNext("Hello, RESULT"),2e3)}).add(result).onError(function(e){alert(e)}).start()}function AsyncChain(){this.index=0,this.callbacks=[],this.onErrorData={callback:function(e){console.log("onError: "+e.name)},context:void 0}}function async1_1(e){console.log("async1_1 func"),setTimeout(e.getNext("Hello, next func"),1e3)}function async2_1(e,t,i){console.log("async2_1 func"),console.log("arg1 = "+t+" arg2 ="+i),setTimeout(e.getNext(1e3,2e3),1e3)}function async3_1(e,t,i){console.log("async3_1 func"),console.log("arg1 = "+t+" arg2 ="+i),setTimeout(e.getNext(314),1e3)}function result_1(e,t){console.log("result func"),console.log("arg1 = "+t)}function SimpleButton(e,t,i){this.game=e,this.textures={},this.textures.idle=t,this.textures.pressed=i,this.globalCallback=void 0,this.globalContext=void 0,this.image=this.game.add.image(0,0,this.textures.idle),this.image.inputEnabled=!0,this.image.events.onInputDown.add(this.onInputDown,this),this.image.events.onInputUp.add(this.onInputUp,this)}function Slider(e,t,i){this.isVertical=void 0!==i&&i,this.rootView=e,this.pointerView=t,this.pointerView.alignIn(this.rootView,Phaser.CENTER),this.rootView.addChild(this.pointerView),this.rootView.inputEnabled=!0,this.rootView.events.onInputDown.add(this.onClick,this),this.pointerView.inputEnabled=!0,this.pointerView.input.enableDrag(),this.pointerView.events.onDragUpdate.add(this.onUpdate,this),this.pointerView.input.allowVerticalDrag=this.isVertical,this.pointerView.input.allowHorizontalDrag=!this.isVertical;var s=this.isVertical?2*t.width:e.width,o=this.isVertical?e.height:2*t.height,n=this.isVertical?-Math.floor(this.pointerView.width/2):0,a=this.isVertical?0:-Math.floor(this.pointerView.height/2),r=new Phaser.Rectangle(n,a,s,o);this.pointerView.input.boundsRect=r,this.value=.5,this.totalLength=this.isVertical?e.height-t.height:e.width-t.width}function JewelModel(){this.type=-1,this.column=-1,this.row=-1,this.isDispatched=!1}function JewelLevel(e,t){this.length=e*t,this.cols=e,this.rows=t,this.jewels=[],this.directionsDelta=[{column:-1,row:0},{column:0,row:-1},{column:1,row:0},{column:0,row:1}];for(var i=0;i<e;i++){this.jewels[i]=[];for(var s=0;s<t;s++)this.jewels[i][s]=new JewelModel,this.jewels[i][s].column=i,this.jewels[i][s].row=s}}function ScoreRepository(e){this.repository=e,this.REPO_SCORE_TAG="scores",this.BEST_SCORE_AMOUNT=8,this.scores={bestScores:[],last:0},this.load()}function JewelButton(e,t){this.SHADOW_Y_DELTA=4,this.game=e,this.shadow=e.add.image(0,0,t.shadow.page,t.shadow.name),this.rootView=this.shadow,this.bg=e.add.image(0,0,t.bg.page,t.bg.name),this.icon=e.add.image(0,0,t.icon.page,t.icon.name),this.icon.alignIn(this.bg,Phaser.CENTER),this.bg.addChild(this.icon),this.bg.y-=this.SHADOW_Y_DELTA,this.rootView.addChild(this.bg),this.rootView.inputEnabled=!0,this.rootView.events.onInputDown.add(this.onInputDown,this),this.rootView.events.onInputUp.add(this.onInputUp,this)}function Explosion(e){this.FRAME_RATE=60,this.ANIMATION_TAG="blast",this.game=e,this.rootView=this.game.add.image(0,0,R.effects.explosion.name),this.animation=this.rootView.animations.add(this.ANIMATION_TAG),this.animation.onComplete.add(function(){this.rootView.kill()},this),this.rootView.kill()}function EffectManager(e,t){this.game=e;var i,s,o,n=[];t.group.forEach(function(a){(o=new Explosion(e).setOnObject(a)).rootView.x+=t.group.x,o.rootView.y+=t.group.y,s=a.model.column,i=a.model.row,void 0===n[s]&&(n[s]=[]),n[s][i]=o}),this.explosions=n}function StartPopup(e){this.game=e,this.bg=e.add.image(0,0,R.images.ui.popupBg.page,R.images.ui.popupBg.name),this.addTitleLayout(),this.addTutorialLayout(),this.buttonBuilder=ButtonBuilder,this.startButton=this.buttonBuilder.bigGreenButton(this.onNewGamePressed,this,Locale.strings.newGame),this.startButton.alignIn(this.bg,Phaser.BOTTOM_CENTER,0,32),this.bg.addChild(this.startButton),this.rootView=this.bg,this.rootView.alignIn(e.world,Phaser.CENTER),this.hide()}function GameOverPopup(e,t){this.scoreRepository=t,this.score=0,this.game=e,this.bg=e.add.image(0,0,R.images.ui.popupBg.page,R.images.ui.popupBg.name),this.addLayout(),this.rootView=this.bg,this.rootView.alignIn(e.world,Phaser.CENTER,0,-20),this.hide()}function SettingsPopup(e){this.game=e,this.bg=e.add.image(0,0,R.images.ui.popupBg.page,R.images.ui.popupBg.name),this.buttonBuilder=ButtonBuilder,this.closeButton=this.buttonBuilder.backButton(0,0,this.hide,this),this.closeButton.alignIn(this.bg,Phaser.BOTTOM_CENTER,0,32),this.bg.addChild(this.closeButton),this.languageButton=this.game.add.button(0,0,R.images.buttons.midBlueIdle.page,function(){this.onLanguageButtonPressed()},this,R.images.buttons.midBlueIdle.name,R.images.buttons.midBlueIdle.name,R.images.buttons.midBluePressed.name,R.images.buttons.midBlueIdle.name),this.languageButton.alignIn(this.bg,Phaser.TOP_CENTER,0,-32),this.languageBtLabel=this.game.add.bitmapText(0,0,R.fonts.robotoBold.name,Locale.getLocale().label,28),this.languageBtLabel.alignIn(this.languageButton,Phaser.CENTER,0,-5),this.bg.addChild(this.languageButton),this.bg.addChild(this.languageBtLabel),this.musicSlider=new VolumeSlider(this.game,Sound.settings.volume.music,Sound.settings.mute.music,Locale.strings.musicOn,Locale.strings.musicOff),this.musicSlider.rootView.alignTo(this.languageButton,Phaser.BOTTOM_CENTER,0,120),this.bg.addChild(this.musicSlider.rootView),this.musicSlider.setVolumeCallback(function(e){Sound.setMusicVolume(e)},this),this.musicSlider.setCheckCallback(function(e){Sound.muteMusic(!e)},this),this.soundSlider=new VolumeSlider(this.game,Sound.settings.volume.sounds,Sound.settings.mute.sounds,Locale.strings.soundOn,Locale.strings.soundOff),this.soundSlider.rootView.alignTo(this.musicSlider.rootView,Phaser.BOTTOM_CENTER,0,120),this.bg.addChild(this.soundSlider.rootView),this.soundSlider.setVolumeCallback(function(e){Sound.setSoundsVolume(e)},this),this.soundSlider.setCheckCallback(function(e){Sound.muteSounds(!e)},this),this.rootView=this.bg,this.hide()}function ScoreTablePopup(e,t){this.game=e,this.scoreRepository=t,this.SCORE_FONT_SIZE=48,this.bg=e.add.image(0,0,R.images.ui.popupBg.page,R.images.ui.popupBg.name),this.addLayout(),this.rootView=this.bg,this.rootView.alignIn(e.world,Phaser.CENTER,0,-20),this.hide()}function LanguageMenuItem(e,t){this.DEFAULT_TINT="0x1E396C",this.SELECTED_TINT="0xFFFFFF",this.locale=t,this.game=e,this.rootView=ImageBuilder.rect(0,0,256,52,"#C8ECEA"),this.rootView.menuItem=this,this.rootView.inputEnabled=!0,this.rootView.events.onInputDown.add(this.onInputDown,this),this.cursorImage=this.game.add.image(0,0,R.images.field.bg9.page,R.images.field.bg9.name),this.cursorImage.refresh9slice(258,54),this.cursorImage.alignIn(this.rootView,Phaser.CENTER),this.rootView.addChild(this.cursorImage);var i=this.locale.label;this.textLabel=e.add.bitmapText(0,0,R.fonts.robotoBold.name,i,36),this.textLabel.tint=this.DEFAULT_TINT,this.textLabel.alignIn(this.rootView,Phaser.CENTER,0,-4),this.rootView.addChild(this.textLabel)}function LanguagePopup(e){this.game=e,this.bg=e.add.image(0,0,R.images.ui.popupBg.page,R.images.ui.popupBg.name),this.localeManager=Locale,this.selectedLocale=this.localeManager.currentLocale,this.addLayout(),this.rootView=this.bg,this.rootView.alignIn(e.world,Phaser.CENTER,0,-20),this.hide()}function VolumeSlider(e,t,i,s,o){this.game=e,this.isOn=!i,this.value=t;var n=e.add.image(0,0,R.images.slider.line.page,R.images.slider.line.name),a=e.add.image(0,0,R.images.slider.pointer.page,R.images.slider.pointer.name);this.slider=new Slider(n,a).setValue(t),this.checkBoxImage=this.game.add.image(0,0,R.images.buttons.checkBox.page,R.images.buttons.checkBox.name),this.checkMarkImage=this.game.add.image(0,0,R.images.buttons.checkMark.page,R.images.buttons.checkMark.name),this.checkMarkImage.alignIn(this.checkBoxImage,Phaser.CENTER),this.checkBoxImage.addChild(this.checkMarkImage),this.checkMarkImage.alpha=this.isOn?1:0,this.checkBoxImage.inputEnabled=!0,this.checkBoxImage.events.onInputDown.add(function(){this.checkMarkImage.alpha=0==this.checkMarkImage.alpha?1:0,this.isOn=!this.isOn,this.text.setText(this.isOn?s:o),this.checkCallback&&this.checkCallback.call(this.checkCallbackContext,this.isOn)},this),this.checkBoxImage.alignTo(this.slider.rootView,Phaser.TOP_RIGHT,-48,-2),this.slider.rootView.addChild(this.checkBoxImage),this.text=this.game.add.bitmapText(0,0,R.fonts.robotoBold.name,s,42),this.text.tint="0x4DA61B",this.text.align="right",this.text.anchor.setTo(1,0),this.text.alignTo(this.checkBoxImage,Phaser.LEFT_CENTER,8,0),this.slider.rootView.addChild(this.text),this.rootView=this.slider.rootView}function BejeweledGroup(e,t,i,s){this.SWAP_ANIMATION_DURATION=200,this.GRID_STEP_FALL_DURATION=140,this.BLAST_ANIMATION_DURATION=100,this.FIELD_BG_PADDING=8,this.game=e,this.GRID_STEP=s||66,this.width=this.GRID_STEP*t,this.height=this.GRID_STEP*i,this.bgImage=e.add.image(0,0,R.images.field.bg9.page,R.images.field.bg9.name),this.refreshBgSize(),this.bgTilesGroup=e.add.group(),this.group=e.add.group(),this.rootView=this.group,this.group.inputEnableChildren=!0,this.selectedJewel=void 0,this.isUiBlocked=!1,this.swipe=new Swipe(this.GRID_STEP),this.jewelGenerator=CristmasJewelGenerator,this.jewelGenerator.init(e),this.cursor=this.jewelGenerator.getCursor(),this.cursor.kill(),this.group.onChildInputDown.add(this.onDown,this),this.game.input.onUp.add(this.onUp,this),this.presenter=new BejeweledPresenter(this,t,i),this.callbacks={select:function(e){},swap:function(e,t,i){},levelGenerated:function(){},hintShown:function(e){},blastStart:function(e){},totalBlastFinish:function(){},singleFallStart:function(e){},singleFallFinish:function(e){},singleBornStart:function(e){},noMoves:function(){}}}function BejeweledPresenter(e,t,i){this.COMBO_AMOUNT_MIN=3,this.view=e,this.selectedJewel=void 0,this.jewelLevel=new JewelLevel(t,i),this.jewelLevel.forEach(this.view.addJewelView,this.view),this.solutions=[],this.combos=[],this.generateLevel()}function UiTextButton(e,t,i,s,o,n){this.PRESSED_Y_DELTA=4,this.game=e,this.bg=ImageBuilder.rect(0,0,t,i,o),this.overlay=ImageBuilder.rect(0,0,t,i,"#333333"),this.overlay.alpha=.5,this.text=this.game.add.text(0,0,s,{font:"24px Arial",fill:"#111111",align:"center"}),this.text.alignIn(this.bg,Phaser.CENTER),this.bg.addChild(this.text),this.bg.addChild(this.overlay),this.bg.inputEnabled=!0,this.bg.events.onInputDown.add(this.onInputDown,this),this.bg.events.onInputUp.add(this.onInputUp,this),this.overlay.kill()}function Preloader(e){this.preload=function(){PhaserConfig.exe(this.game),ImageBuilder.init(this.game),e.preload(this.game),this.preloaderImage=new PreloaderImage(this.game)},this.loadUpdate=function(){this.preloaderImage.loadUpdate()},this.create=function(){document.getElementById(AppConfig.preloaderId).style.display="none",Sound.init(this.game,Repository),ButtonBuilder.init(this.game),ProfitSystem.init(this.game),Locale.autodetectLocale(),document.title=Locale.strings.indexTitle,this.game.state.start(States.START_SCREEN)}}function PreloaderImage(e){this.game=e;var t=Math.floor(AppConfig.width/8*6);this.percent=5,this.rootView=ImageBuilder.rect(0,0,t,24,"#112140"),this.progressImage=ImageBuilder.rect(0,0,t,24,"#58B000"),this.progressGlowImage=ImageBuilder.rect(0,8,t,4,"#7EFD00"),this.frameImage=ImageBuilder.strokeRect(0,0,t,24,"#182E58",4),this.rootView.addChild(this.progressImage),this.rootView.addChild(this.progressGlowImage),this.rootView.addChild(this.frameImage),this.rootView.alignIn(e.world,Phaser.CENTER),this.progressImage.scale.x=this.percent/100,this.progressGlowImage.scale.x=this.percent/100}function ScoreLogic(e){this.scoreRepository=e,this.SCORE_JEWEL=10,this.SCORE_COMBO_MIN=3,this.SCORE_EXTRA_COMBO_BONUS=10,this.HINT_SCORE_PRICE=30,this.score=0,this.bestScore=this.scoreRepository.getBest()}function MainState(){this.create=function(){this.COLUMNS=8,this.ROWS=8,this.GRIDSTEP=70,this.gameOverIndex=0,this.gameOverIndexDensity=2;var e=ButtonBuilder;this.scoreRepository=new ScoreRepository(Repository),this.scoreLogic=new ScoreLogic(this.scoreRepository);var t=this.game.add.image(0,0,R.images.bg.cristmas),i=this.addImage(0,0,R.images.ui.scoreBg);i.alignIn(this.game.world,Phaser.TOP_LEFT,-96,-36),this.scoreText=this.game.add.bitmapText(0,0,R.fonts.fedoka.name,""+this.scoreLogic.score,48),this.scoreText.tint="0xF9DC07",this.scoreText.anchor.set(.5,.5),this.scoreText.alignIn(i,Phaser.CENTER),this.bestScoreText=this.game.add.bitmapText(0,0,R.fonts.robotoBold.name,this.scoreLogic.getBestScoreText(),24),this.bestScoreText.tint="0xF9DC07",this.bestScoreText.align="center",this.bestScoreText.anchor.setTo(.5,.5),this.bestScoreText.alignTo(i,Phaser.BOTTOM_CENTER,0,4),this.newgameButton=e.newGameButton(0,0,this.onNewGameClick,this),this.newgameButton.alignTo(i,Phaser.LEFT_CENTER,6,0),this.scoreButton=e.scoreButton(0,0,this.onScoreButtonClick,this),this.scoreButton.alignTo(i,Phaser.RIGHT_CENTER,6,0),this.settingsButton=e.settingsButton(0,0,this.onSettingsClick,this),this.settingsButton.alignTo(this.scoreButton.rootView,Phaser.RIGHT_CENTER,10,0),this.bejeweledComponent=this.addBejeweled(this.COLUMNS,this.ROWS,this.GRIDSTEP),this.addBejeweledLogic(this.bejeweledComponent);this.game.add.image(0,-10,R.images.overlay.snowTop.page,R.images.overlay.snowTop.name);this.game.add.image(0,0,R.images.overlay.snowBottom.page,R.images.overlay.snowBottom.name).alignIn(t,Phaser.BOTTOM_CENTER),this.effectManager=new EffectManager(this.game,this.bejeweledComponent),this.hintButton=e.hintButton(0,0,this.onHintButtonClick,this),this.hintButton.alignTo(this.bejeweledComponent.rootView,Phaser.BOTTOM_CENTER,0,20),this.addSettingsPopup(),this.addGameOverPopup(),this.addScoreTablePopup(),this.addLanguagePopup(),startScreenNotShowed&&(startScreenNotShowed=!1,this.showStart()),Sound.playMusic(),this.game.time.events.add(15e3,function(){ProfitSystem.showBanner()},this)},this.addImage=function(e,t,i){return this.game.add.image(e,t,i.page,i.name)},this.showStart=function(){this.lockUi(!0),this.hintButton.kill();new StartPopup(this.game).setNewGameCallBack(this.onStartGameClick,this).show()},this.addSettingsPopup=function(){this.settingsPopup=new SettingsPopup(this.game).setLanguageCallBack(this.showLanguagePopup,this).setOnHideCallback(this.onSettingsHide,this),this.settingsPopup.rootView.alignIn(this.game.world,Phaser.CENTER)},this.addGameOverPopup=function(){this.gameOverPopup=new GameOverPopup(this.game,this.scoreRepository).setNewGameCallBack(this.onGameOverNewGameClick,this).alignIn(this.game.world,Phaser.CENTER).hide()},this.addScoreTablePopup=function(){this.scoreTablePopup=new ScoreTablePopup(this.game,this.scoreRepository).setBackCallBack(this.onResumeClick,this).alignIn(this.game.world,Phaser.CENTER).hide()},this.addLanguagePopup=function(){this.languagePopup=new LanguagePopup(this.game).setOnHideCallback(this.onLanguagePopupHide,this).alignIn(this.game.world,Phaser.CENTER).hide()},this.showLanguagePopup=function(){this.lockUi(!0),this.languagePopup.show()},this.onLanguagePopupHide=function(e){this.lockUi(!1),Locale.currentLocale!==e&&(Locale.setLocale(e),this.game.state.start(States.START_SCREEN))},this.addBejeweled=function(e,t,i){var s=new BejeweledGroup(this.game,e,t,i);return s.alignIn(this.game.world,Phaser.CENTER,0,-12),s},this.addBejeweledLogic=function(e){var t=this;e.callbacks.select=function(e){Sound.playSound(Sound.SELECT)},e.callbacks.swap=function(e,t,i){i||Sound.playSound(Sound.UNDO)},e.callbacks.levelGenerated=function(){},e.callbacks.hintShown=function(e){t.scoreLogic.onHint(e),t.scoreText.setText(t.scoreLogic.score)},e.callbacks.blastStart=function(e){t.effectManager.blast(e),Sound.playSound(Sound.BLAST),t.scoreLogic.onCombo(e),t.scoreText.setText(t.scoreLogic.score)},e.callbacks.singleFallStart=function(e){Sound.playSound(Sound.FALL)},e.callbacks.noMoves=function(){t.onGameOver()}},this.onGameOver=function(){this.lockUi(!0),this.gameOverPopup.show(this.scoreLogic.score)},this.onSettingsClick=function(){this.isUiLocked||(this.lockUi(!0),this.settingsPopup.show())},this.onStartGameClick=function(){this.hintButton.revive(),this.onResumeClick()},this.onScoreButtonClick=function(){this.isUiLocked||(this.lockUi(!0),this.scoreTablePopup.show())},this.onHintButtonClick=function(){this.isUiLocked||this.bejeweledComponent.showHint()},this.onNewGameClick=function(){this.isUiLocked||this.restart()},this.onGameOverNewGameClick=function(){this.lockUi(!1),++this.gameOverIndex%this.gameOverIndexDensity==0&&ProfitSystem.showFullscreen(),this.restart()},this.restart=function(){this.game.state.start(States.START_SCREEN)},this.onSettingsHide=function(){this.lockUi(!1)},this.onResumeClick=function(){this.lockUi(!1)},this.lockUi=function(e){this.isUiLocked=e,e?this.hintButton.kill():this.hintButton.revive(),this.bejeweledComponent.lockUiGlobal(e)}}var Directions={NONE:-777,LEFT:0,UP:1,RIGHT:2,DOWN:3};Swipe.prototype.start=function(e,t){this.x=e,this.y=t,this.started=!0},Swipe.prototype.check=function(e,t){return 0!=this.started&&(this.distance.x=e-this.x,this.distance.y=t-this.y,this.distance.total=Math.sqrt(Math.pow(this.distance.x,2)+Math.pow(this.distance.y,2)),this.distance.total<this.SENS_DISTANCE?(this.direction=this.directions.NONE,!1):(Math.abs(this.distance.x)>Math.abs(this.distance.y)?this.direction=this.distance.x>0?this.directions.RIGHT:this.directions.LEFT:this.direction=this.distance.y>0?this.directions.DOWN:this.directions.UP,this.started=!1,!0))},Array.prototype.getRandom=function(){return this[Math.floor(Math.random()*this.length)]},Array.prototype.shuffle=function(){for(var e,t,i=this.length;0!==i;)t=Math.floor(Math.random()*i),e=this[--i],this[i]=this[t],this[t]=e;return this},Array.prototype.shuffleCopy=function(){return this.slice().shuffle()},AsyncChain.prototype.onError=function(e,t){return this.onError.callback=e,this.onError.context=t,this},AsyncChain.prototype.start=function(){this.index=0,this.getNext()()},AsyncChain.prototype.add=function(e,t){return this.callbacks.push({callback:e,context:t}),this},AsyncChain.prototype.getNext=function(){if(this.index>=this.callbacks.length)throw"No more callbacks in asyncChain";var e=[].slice.call(arguments);e.unshift(this);var t=this.callbacks[this.index++];return function(){try{return t.callback.apply(t.context,e)}catch(t){console.log("e ="+t),e[0].onErrorData.callback.call(e[0].onErrorData.context,t)}}},AsyncChain.prototype.onError=function(e,t){return this.onError.callback=e,this.onError.context=t,this},AsyncChain.prototype.start=function(){this.index=0,this.getNext()()},AsyncChain.prototype.add=function(e,t){return this.callbacks.push({callback:e,context:t}),this},AsyncChain.prototype.getNext=function(){if(this.index>=this.callbacks.length)throw"No more callbacks in asyncChain";var e=[].slice.call(arguments);e.unshift(this);var t=this.callbacks[this.index++];return function(){try{return t.callback.apply(t.context,e)}catch(t){console.log("e ="+t),e[0].onErrorData.callback.call(e[0].onErrorData.context,t)}}},SimpleButton.prototype.onInputDown=function(){console.log("SimpleButton onInputDown"),this.image.setTexture(this.textures.pressed),this.globalCallback&&this.globalCallback.apply(this.globalContext)},SimpleButton.prototype.onInputUp=function(){console.log("SimpleButton onInputUp"),this.image.setTexture(this.textures.idle)},SimpleButton.prototype.setCallback=function(e,t){return this.globalCallback=e,this.globalContext=t,this},SimpleButton.prototype.setXY=function(e,t){return this.image.x=e,this.image.y=t,this};var ImageBuilder={init:function(e){this.game=e}};ImageBuilder.cachedTexture=function(e){if(this.game.cache.checkBitmapDataKey(e))return this.game.cache.getBitmapData(e)},ImageBuilder.rectTexture=function(e,t,i){var s="imgBuilder_rectTxtr"+e+"_"+t+"_"+i,o=this.cachedTexture(s);return void 0===o&&((o=this.game.add.bitmapData(e,t)).ctx.fillStyle=i,o.ctx.fillRect(0,0,e,t)),o},ImageBuilder.strokeRectTexture=function(e,t,i,s){var o="imgBuilder_strokedRectTxtr"+e+"_"+t+"_"+i+"_"+s,n=this.cachedTexture(o);return void 0===n&&((n=this.game.add.bitmapData(e,t)).ctx.strokeStyle=i,n.ctx.lineWidth=s,n.ctx.strokeRect(0,0,e,t)),n},ImageBuilder.rect=function(e,t,i,s,o){return this.game.add.image(e,t,this.rectTexture(i,s,o))},ImageBuilder.strokeRect=function(e,t,i,s,o,n){return this.game.add.image(e,t,this.strokeRectTexture(i,s,o,n))},Slider.prototype.setXY=function(e,t){return this.rootView.x=e,this.rootView.y=t,this},Slider.prototype.setCallback=function(e,t){return this.callback=e,this.context=t,this},Slider.prototype.onClick=function(e,t){this.isVertical?this.pointerView.y=t.y-this.rootView.y:this.pointerView.x=t.x-this.rootView.x,this.onUpdate()},Slider.prototype.onUpdate=function(){this.updateValue(),this.callback&&this.callback.call(this.context,this.value)},Slider.prototype.updateValue=function(){var e=this.isVertical?this.totalLength-this.pointerView.y:this.pointerView.x;this.value=e/this.totalLength},Slider.prototype.getValue=function(){this.isVertical?this.pointerView.y:this.pointerView.x;return value},Slider.prototype.setValue=function(e){this.value=e>1?1:e,this.value=this.value<0?0:this.value;var t=Math.floor(e*this.totalLength);return this.isVertical?this.pointerView.y=this.totalLength-t:this.pointerView.x=t,this};var MyPhaser=MyPhaser||{};MyPhaser.Fps=function(e,t,i,s,o){t=t||0,i=i||0,s=s||25,o=o||"#999999",Phaser.Group.call(this,e),this.game.time.advancedTiming=!0,this.label=this.game.add.text(t,i,"",{font:s+"px Arial",fill:o,align:"center"}),this.add(this.label),this.game.add.group(this)},MyPhaser.Fps.constructor=MyPhaser.Fps,MyPhaser.Fps.prototype=Object.create(Phaser.Group.prototype),MyPhaser.Fps.prototype.update=function(){this.label.setText(this.game.time.fps+" fps")},(MyPhaser=MyPhaser||{}).slice9={},Phaser.Image.prototype.refresh9slice=function(e,t){var i=this,s=this.frameName,o=i.texture.baseTexture,n=i.texture.frame,a=s.split(".",6),r=parseInt(a[1]),l=parseInt(a[2]),h=parseInt(a[3]),c=parseInt(a[4]);i.loadTexture(new Phaser.RenderTexture(this.game,e,t)),i.texture.resize(e,t,!0);var u,g,d,p,m,w,f,b,T=[0,r,n.width-h,n.width],y=[0,l,n.height-c,n.height],S=[0,r,e-h,e],B=[0,l,t-c,t];for(g=0;g<3;g++)for(u=0;u<3;u++)d=n.x+i.texture.frame.x+T[u],p=n.y+i.texture.frame.y+y[g],m=Math.max(T[u+1]-T[u],1),w=Math.max(y[g+1]-y[g],1),f=new PIXI.Rectangle(d,p,m,w),(b=new Phaser.Sprite(this.game,0,0,new PIXI.Texture(o,f))).width=S[u+1]-S[u],b.height=B[g+1]-B[g],i.texture.renderXY(b,S[u],B[g]);return i},MyPhaser.slice9.createImage=function(e,t,i,s,o){var n=new Phaser.Image(e,0,0,t,i),a=n.texture.baseTexture,r=n.texture.frame,l=i.split(".",6),h=parseInt(l[1]),c=parseInt(l[2]),u=parseInt(l[3]),g=parseInt(l[4]);n.loadTexture(new Phaser.RenderTexture(e,s,o)),n.texture.resize(s,o,!0);var d,p,m,w,f,b,T,y,S=[0,h,r.width-u,r.width],B=[0,c,r.height-g,r.height],E=[0,h,s-u,s],R=[0,c,o-g,o];for(p=0;p<3;p++)for(d=0;d<3;d++)m=r.x+n.texture.frame.x+S[d],w=r.y+n.texture.frame.y+B[p],f=Math.max(S[d+1]-S[d],1),b=Math.max(B[p+1]-B[p],1),T=new PIXI.Rectangle(m,w,f,b),(y=new Phaser.Sprite(e,0,0,new PIXI.Texture(a,T))).width=E[d+1]-E[d],y.height=R[p+1]-R[p],n.texture.renderXY(y,E[d],R[p]);return n},MyPhaser.slice9.createTexture=function(e,t,i,s){var o=new Phaser.Sprite(this.game,0,0,e,t),n=o.texture.baseTexture,a=o.texture.frame,r=t.split(".",6),l=parseInt(r[1]),h=parseInt(r[2]),c=parseInt(r[3]),u=parseInt(r[4]);o.loadTexture(new Phaser.RenderTexture(this.game,i,s)),o.texture.resize(i,s,!0);var g,d,p,m,w,f,b,T,y=[0,l,a.width-c,a.width],S=[0,h,a.height-u,a.height],B=[0,l,i-c,i],E=[0,h,s-u,s];for(d=0;d<3;d++)for(g=0;g<3;g++)p=a.x+o.texture.frame.x+y[g],m=a.y+o.texture.frame.y+S[d],w=Math.max(y[g+1]-y[g],1),f=Math.max(S[d+1]-S[d],1),b=new PIXI.Rectangle(p,m,w,f),(T=new Phaser.Sprite(this.game,0,0,new PIXI.Texture(n,b))).width=B[g+1]-B[g],T.height=E[d+1]-E[d],o.texture.renderXY(T,B[g],E[d]);return o.texture};var AppConfig={width:560,height:960,canvasId:"canvas",preloaderId:"preloader",gameDistribution:!0},JewelType={NONE:-1,COMMON_0:0,COMMON_1:1,COMMON_2:2,COMMON_3:3,COMMON_4:4,COMMON_5:5,COMMON_6:6,COMMON_7:7};JewelType.getRandomCommon=function(){return Math.round(Math.random()*this.COMMON_7)},JewelType.getCommonTypeArray=function(){return[this.COMMON_0,this.COMMON_1,this.COMMON_2,this.COMMON_3,this.COMMON_4,this.COMMON_5,this.COMMON_6,this.COMMON_7]},JewelLevel.prototype.fill=function(e,t){return this.forEach(function(i){i.type=e.call(t)}),this},JewelLevel.prototype.forEach=function(e,t){for(var i=0;i<this.cols;i++)for(var s=0;s<this.rows;s++)e.call(t,this.jewels[i][s]);return this},JewelLevel.prototype.isNear=function(e,t){var i=e.row==t.row&&1==Math.abs(e.column-t.column),s=e.column==t.column&&1==Math.abs(e.row-t.row);return i||s},JewelLevel.prototype.getNears=function(e){var t=[];return e.column>0&&t.push(this.jewels[e.column-1][e.row]),e.column<this.cols-1&&t.push(this.jewels[e.column+1][e.row]),e.row>0&&t.push(this.jewels[e.column][e.row-1]),e.row<this.rows-1&&t.push(this.jewels[e.column][e.row+1]),t},JewelLevel.prototype.getSameNears=function(e){this.resetDispatched();var t=[];t.push(e);var i,s=0;do{if(i=t[s],this.getNears(i).forEach(function(s){s&&!s.isDispatched&&s.type===e.type&&(i.isDispatched=!0,t.push(s))}),++s>this.length){console.log("sameNearIndex = "+s),console.log("this.jewels.length = "+this.length),console.log("NONSENSE SAME NEAR LENTGH, BREAK THE LOOP");break}}while(s<t.length);return t},JewelLevel.prototype.swap=function(e,t){var i=e.column,s=e.row;return e.column=t.column,e.row=t.row,t.column=i,t.row=s,this.jewels[e.column][e.row]=e,this.jewels[t.column][t.row]=t,this},JewelLevel.prototype.selectNearByDirection=function(e,t){var i=e.column+this.directionsDelta[t].column,s=e.row+this.directionsDelta[t].row;if(!(i<0||s<0||i>=this.cols||s>=this.rows))return this.jewels[i][s]},JewelLevel.prototype.resetDispatched=function(){var e,t;for(e=0;e<this.cols;e++)for(t=0;t<this.rows;t++)this.jewels[e][t].isDispatched=!1},JewelLevel.prototype.countGroups=function(e){this.resetDispatched();var t,i,s,o=[],n=[];for(t=0;t<this.cols;t++)for(i=0;i<this.rows;i++)(s=this.jewels[t][i]).isDispatched||(n=this.getSameNears(s)).length>=e&&o.push(n);return o},JewelLevel.prototype.getSolutions=function(e){var t,i,s=this.cols-1,o=this.rows-1,n=[];for(t=0;t<=s;t++)for(i=0;i<=o;i++)t<s&&this.checkSolution(this.jewels[t][i],this.jewels[t+1][i],e,n),i<o&&this.checkSolution(this.jewels[t][i],this.jewels[t][i+1],e,n);return this.checkSolution(this.jewels[s][o],this.jewels[s-1][o],e,n),this.checkSolution(this.jewels[s][o],this.jewels[s][o-1],e,n),n},JewelLevel.prototype.checkSolution=function(e,t,i,s){this.swap(e,t);var o=this.getSameNears(e).length;o>=i?s.push({hint:e,target:t,length:o}):(o=this.getSameNears(t).length)>=i&&s.push({hint:t,target:e,length:o}),this.swap(e,t)};var R={dir:{images:"img"},fonts:{fedoka:{name:"fedoka",png:"fedoka_one_numeric_0.png",xml:"fedoka_one_numeric.fnt"},robotoBold:{name:"robotoBold",png:"robotoBold_0.png",xml:"robotoBold.fnt"}},sounds:{winteryLoop:{name:"winteryLoop",files:["sounds/winteryloop.mp3","sounds/winteryloop.ogg"]},click:{name:"click",files:["sounds/click.mp3","sounds/click.ogg"]},fall:{name:"switch23",files:["sounds/switch23.mp3","sounds/switch23.ogg"]},blast:{name:"steamhiss",files:["sounds/steamhiss.mp3","sounds/steamhiss.ogg"]},undoSwap:{name:"undowall",files:["sounds/undowall.mp3","sounds/undowall.ogg"]},gameover:{name:"gameover",files:["sounds/gameover.mp3","sounds/gameover.ogg"]}},atlas:{common:["cristmas_tiles","start-screen"]},effects:{explosion:{name:"explosion",file:"img/exposions_match3_001.png",frameWidth:256,frameHeight:256,frameMax:-1}},images:{bg:{cristmas:"bg_first.png"},field:{bg9:{page:"cristmas_tiles",name:"fieldbg.16.16.16.16.9"},tileBg:{page:"cristmas_tiles",name:"tile-bg"}},overlay:{snowTop:{page:"cristmas_tiles",name:"snow_r1_c1"},snowBottom:{page:"cristmas_tiles",name:"snow_r3_c1"}},ui:{scoreBg:{page:"cristmas_tiles",name:"score_bg"},popupBg:{page:"start-screen",name:"popup-bg"},santa:{page:"start-screen",name:"santa"},snowTopping:{page:"start-screen",name:"snow-pop-topping"},tutorial01:{page:"start-screen",name:"tutorial-01"},titleLogo:{page:"start-screen",name:"titlelogo"},elkaBg:{page:"start-screen",name:"elka-bg"}},slider:{line:{page:"cristmas_tiles",name:"slider_r1_c1"},pointer:{page:"cristmas_tiles",name:"slider_r3_c2"}},buttons:{bt75greenbg:{page:"cristmas_tiles",name:"bt75greenbg"},bt75yellowbg:{page:"cristmas_tiles",name:"bt75yellowbg"},bt75iconReplay:{page:"cristmas_tiles",name:"bt75icon-replay"},bt75iconSettings:{page:"cristmas_tiles",name:"bt75icon-settings"},bt75iconTrophy:{page:"cristmas_tiles",name:"bt75icon-trophy"},bt75shadow:{page:"cristmas_tiles",name:"bt75shadow"},bigGreenIdle:{page:"cristmas_tiles",name:"button-green-big-idle"},bigGreenPressed:{page:"cristmas_tiles",name:"button-green-big-pressed"},midGreenIdle:{page:"cristmas_tiles",name:"button-green-mid-idle"},midGreenPressed:{page:"cristmas_tiles",name:"button-green-mid-pressed"},midBlueIdle:{page:"cristmas_tiles",name:"button-blue-mid-idle"},midBluePressed:{page:"cristmas_tiles",name:"button-blue-mid-pressed"},checkBox:{page:"cristmas_tiles",name:"buttons-checkbox"},checkMark:{page:"cristmas_tiles",name:"buttons-checkmark"}},jewels:{snow:{page:"cristmas_tiles",name:"chips_68x68_size_r1_c1"},sockGreen:{page:"cristmas_tiles",name:"chips_68x68_size_r1_c2"},candyMan:{page:"cristmas_tiles",name:"chips_68x68_size_r1_c3"},blueBall:{page:"cristmas_tiles",name:"chips_68x68_size_r1_c4"},sockPink:{page:"cristmas_tiles",name:"chips_68x68_size_r1_c5"},boxGift:{page:"cristmas_tiles",name:"chips_68x68_size_r1_c6"},candyHeart:{page:"cristmas_tiles",name:"chips_68x68_size_r1_c7"},jewelOrange:{page:"cristmas_tiles",name:"chips_68x68_size_r1_c8"},gloves:{page:"cristmas_tiles",name:"chips_68x68_size_r2_c1"},candyStick:{page:"cristmas_tiles",name:"chips_68x68_size_r2_c2"},candyRound:{page:"cristmas_tiles",name:"chips_68x68_size_r2_c3"},cap:{page:"cristmas_tiles",name:"chips_68x68_size_r2_c4"},star:{page:"cristmas_tiles",name:"chips_68x68_size_r2_c5"},snowFoot:{page:"cristmas_tiles",name:"chips_68x68_size_r2_c6"},ice:{page:"cristmas_tiles",name:"chips_68x68_size_r2_c7"},boxWood:{page:"cristmas_tiles",name:"chips_68x68_size_r2_c8"}}},style:{uiIconLabel:{font:"22px Arial",fill:"#FFFFFF",align:"left"},levelBarLabel:{font:"16px Arial",fill:"#FFFFFF",align:"center"},levelBarTitle:{font:"24px Arial",fill:"#FFFFFF",align:"center"},healthBarLabel:{font:"16px Arial",fill:"#FFFFFF",align:"center"},healthBarTitle:{font:"16px Arial",fill:"#FFFFFF",align:"center"},monsterTitle:{font:"32px Arial",fill:"#354048",align:"left"},monsterDesc:{font:"16px Arial",fill:"#354048",align:"left"},monsterHealthBar:{font:"16px Arial",fill:"#354048",align:"right"},monsterDamageFloater:{font:"24px Arial",fill:"#DD2200",align:"right"}},colors:{MASK_OPACITY_1:"#ffffff",WHITE:"#ffffff",BG_DARK:"#333333",PROGRESS_BAR:"#9966CC",PROGRESS_BAR_BG:"#525855",SHADOW_BAR:"#222222",HEALTH_BAR:"#CC3300",DAMAGE_BAR:"#56221F",DEATH_EFFECT_BAR:"#CC3300"},strings:{ru:{indexTitle:"Игра Дед Мороз Три в Ряд - играть онлайн бесплатно 2018",gameNameInLogo:"Дед Мороз и Три в Ряд",ok:"ОК",backSettings:"ОК",newGame:"НОВАЯ ИГРА",scoreTable:"РЕКОРДЫ",musicOn:"Музыка",musicOff:"Музыка",soundOn:"Звуки",soundOff:"Звуки",hintButton:"ПОДСКАЗКА",gameoverTitle:"ХОДОВ НЕТ",gameoverScorePrefix:"набрано",gameoverRestartButton:"ИГРАТЬ ЕЩЕ",bestScorePrefix:"лучший рекорд: ",scoreTitle:"РЕКОРДЫ",scoreBackButton:"ЗАКРЫТЬ",tutorial1text1:"Собирай\nподарки\nпо 3 в ряд\nили в группе",tutorial1text2:"Шар можно сдвинуть\nвлево и вверх"},en:{indexTitle:"Super Happy Winter Match 3 free online game 2018",gameNameInLogo:"Happy Winter Match 3",ok:"OK",backSettings:"BACK",newGame:"NEW GAME",scoreTable:"SCORE TABLE",musicOn:"Music On",musicOff:"Music Off",soundOn:"Sounds On",soundOff:"Sounds Off",hintButton:"HINT",gameoverTitle:"GAME OVER",gameoverScorePrefix:"your score",gameoverRestartButton:"PLAY AGAIN",bestScorePrefix:"best score: ",scoreTitle:"BEST SCORES",scoreBackButton:"BACK",tutorial1text1:"Tap to select\nor swipe items\nto match 3\nin row or group",tutorial1text2:"Christmas ball\ncan go left or up"},de:{indexTitle:"Super Happy Winter Match 3 kostenloses Online-Spiel 2018",gameNameInLogo:"Happy Winter Match 3",ok:"OK",backSettings:"ZURÜCK",newGame:"NEUES SPIEL",scoreTable:"RANGLISTE",musicOn:"Musik an",musicOff:"Musik aus",soundOn:"Ton an",soundOff:"Ton aus",hintButton:"HINWEIS",gameoverTitle:"SPIEL IST AUS",gameoverScorePrefix:"Ihr Ergebnis",gameoverRestartButton:"SPIEL NOCHMAL",bestScorePrefix:"bestes Ergebnis: ",scoreTitle:"RANGLISTE",scoreBackButton:"ZURÜCK",tutorial1text1:"Bring gleich\nBlöcke\nzusammen",tutorial1text2:"Christmas Ball\nkann nach links\noder oben gehen"},tr:{indexTitle:"Super Happy Winter Match 3 ücretsiz online oyun 2018",gameNameInLogo:"Happy Winter Match 3",ok:"OK",backSettings:"GERİ",newGame:"YENİ OYUN",scoreTable:"skor tablosu",musicOn:"Müzik",musicOff:"Müzik",soundOn:"Ses",soundOff:"Ses",hintButton:"İPUCU",gameoverTitle:"OYUN BİTTİ",gameoverScorePrefix:"Gol",gameoverRestartButton:"TEKRAR OYNA",bestScorePrefix:"en iyi puan: ",scoreTitle:"EN İYİ PUAN",scoreBackButton:"GERİ",tutorial1text1:"Aynı blokları\nbir araya\ngetirin",tutorial1text2:"Noel Balya\nsola veya sağa\ngidebilir"},pl:{indexTitle:"Super Happy Winter Match 3 darmowa gra online 2018",gameNameInLogo:"Happy Winter Match 3",ok:"OK",backSettings:"PLECY",newGame:"NOWA GRA",scoreTable:"TABELA WYNIKÓW",musicOn:"Muzyka",musicOff:"Muzyk",soundOn:"Dźwięki",soundOff:"Dźwięki",hintButton:"Pokaż mi",gameoverTitle:"KONIEC GRY",gameoverScorePrefix:"Twój wynik",gameoverRestartButton:"NOWA GRA",bestScorePrefix:"Najlepszy wynik: ",scoreTitle:"TABELA WYNIKÓW",scoreBackButton:"PLECY",tutorial1text1:"Zbieraj prezenty\nw 3 z rzędu\nlub w grupie",tutorial1text2:"Piłkę można\nprzesunąć w\nlewo i w górę"},nl:{indexTitle:"Super Happy Winter Match 3 gratis online game 2018",gameNameInLogo:"Happy Winter Match 3",ok:"OK",backSettings:"ACHTER",newGame:"NIEUW SPEL",scoreTable:"SCOORTAFEL",musicOn:"Muziek",musicOff:"Muziek",soundOn:"Sounds",soundOff:"Sounds",hintButton:"TIP",gameoverTitle:"SPEL IS OVER",gameoverScorePrefix:"jouw score",gameoverRestartButton:"SPEEL OPNIEUW",bestScorePrefix:"beste score: ",scoreTitle:"BESTE SCORES",scoreBackButton:"ACHTER",tutorial1text1:"Verzamel\nitems\nsamen",tutorial1text2:"Kerstbal kan naar\nlinks of naar\nboven gaan"},es:{indexTitle:"Juego gratis en línea Super Happy Winter Match 3 2018",gameNameInLogo:"Happy Winter Match 3",ok:"OK",backSettings:"ESPALDA",scoreBackButton:"ESPALDA",newGame:"NUEVO JUEGO",scoreTable:"Puntuaciones",musicOn:"Música",musicOff:"Música",soundOn:"Sonidos",soundOff:"Sonidos",hintButton:"SOLUCIÓN",gameoverTitle:"JUEGO TERMINADO",gameoverScorePrefix:"tu puntuación",gameoverRestartButton:"NUEVO JUEGO",bestScorePrefix:"mejor puntuación: ",scoreTitle:"BEST SCORES",tutorial1text1:"",tutorial1text2:""},pt:{indexTitle:"Super Happy Winter Match 3 jogo online grátis 2018",gameNameInLogo:"Happy Winter Match 3",ok:"OK",backSettings:"COSTAS",scoreBackButton:"COSTAS",newGame:"NOVO JOGO",scoreTable:"MELHORES",musicOn:"Música",musicOff:"Música",soundOn:"Soa",soundOff:"Soa",hintButton:"SOLUÇÃO",gameoverTitle:"FIM DE JOGO",gameoverScorePrefix:"Sua pontuação",gameoverRestartButton:"NOVO JOGO",bestScorePrefix:"melhor pontuação: ",scoreTitle:"MELHORES",tutorial1text1:"",tutorial1text2:""},fr:{indexTitle:"Super Happy Winter Match 3 jeu gratuit en ligne 2018",gameNameInLogo:"Happy Winter Match 3",ok:"OK",backSettings:"ARRIÈRE",newGame:"NOUVEAU JEU",scoreTable:"TABLE DE SCORE",musicOn:"La musique",musicOff:"La musique",soundOn:"Des sons",soundOff:"Des sons",hintButton:"Solution",gameoverTitle:"JEU TERMINÉ",gameoverScorePrefix:"ton score",gameoverRestartButton:"REJOUER",bestScorePrefix:"meilleur score: ",scoreTitle:"TABLE DE SCORE",scoreBackButton:"ARRIÈRE",tutorial1text1:"",tutorial1text2:""}}},Locale={locales:{en:{strings:R.strings.en,label:"English",code:"en"},ru:{strings:R.strings.ru,label:"Русский",code:"ru"},de:{strings:R.strings.de,label:"Deutsche",code:"de"},tr:{strings:R.strings.tr,label:"Türk",code:"tr"},nl:{strings:R.strings.nl,label:"Nederlands",code:"nl"},es:{strings:R.strings.es,label:"Español",code:"es"},pt:{strings:R.strings.pt,label:"Portugues",code:"pt"},fr:{strings:R.strings.fr,label:"Français",code:"fr"}},currentLocale:void 0,strings:R.strings.en};Locale.setLocale=function(e){e&&(this.currentLocale=e,this.strings=this.currentLocale.strings)},Locale.getLocale=function(){return void 0===this.currentLocale&&(this.currentLocale=this.locales.en),this.currentLocale},Locale.autodetectLocale=function(){var e=navigator.language;this.setLocale(this.getLocaleByCode(e))},Locale.getLocaleByCode=function(e){var t=this.locales.en;if(void 0===e)return t;for(var i in this.locales)if(e.indexOf(this.locales[i].code)>-1)return this.locales[i]};var ProfitSystem={};ProfitSystem.init=function(e){this.game=e,this.game.device.android?this.androidInit():AppConfig.gameDistribution&&this.gdistributionInit()},ProfitSystem.androidInit=function(){try{Appodeal.setTesting(!1),Appodeal.disableLocationPermissionCheck(),Appodeal.initialize("6dbdcd8af4f87460fee0c08f67aafd7cb9ba53264646147c",Appodeal.BANNER),Appodeal.enableBannerCallbacks(!0)}catch(e){}},ProfitSystem.gdistributionInit=function(){var e={gameId:"c9b1682891424b6da63fa8e85feec089",userId:"6E63519E-508E-4142-9472-7BB01AE52CD6-s1",pauseGame:function(){ProfitSystem.game.paused=!0,ProfitSystem.game.sound.mute=!0},resumeGame:function(){ProfitSystem.game.paused=!1,ProfitSystem.game.sound.mute=!1},onInit:function(e){},onError:function(e){}};!function(e,t,i,s,o,n,a){e.GameDistribution=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,n=t.createElement(i),a=t.getElementsByTagName(i)[0],n.async=1,n.src="//html5.api.gamedistribution.com/libs/gd/api.js",a.parentNode.insertBefore(n,a)}(window,document,"script",0,"gdApi"),gdApi(e)},ProfitSystem.showBanner=function(){this.game.device.android&&this.game.device.desktop?this.androidShowBanner():this.webShowBanner()},ProfitSystem.androidShowBanner=function(){try{Appodeal.isLoaded(Appodeal.BANNER_BOTTOM,function(e){e&&Appodeal.show(Appodeal.BANNER_BOTTOM)})}catch(e){}},ProfitSystem.webShowBanner=function(){},ProfitSystem.showFullscreen=function(){try{AppConfig.gameDistribution&&this.game.device.desktop&&this.showGameDistributionFullscreen()}catch(e){}},ProfitSystem.showGameDistributionFullscreen=function(){window.gdApi.showBanner()};var AssetLoader={};AssetLoader.loadPages=function(e){var t,i,s;for(t=0;t<e.length;t++)s=e[t],i=R.dir.images+"/"+s,this.game.load.atlas(s,i+".png",i+".json")},AssetLoader.loadBitmapFont=function(e){this.game.load.bitmapFont(e.name,R.dir.images+"/"+e.png,R.dir.images+"/"+e.xml)},AssetLoader.loadImage=function(e){this.game.load.image(e,R.dir.images+"/"+e)},AssetLoader.loadEffect=function(e){this.game.load.spritesheet(e.name,e.file,e.frameWidth,e.frameHeight,e.frameMax)},AssetLoader.loadSound=function(e){this.game.load.audio(e.name,e.files)},AssetLoader.preload=function(e){this.game=e,this.loadBitmapFont(R.fonts.fedoka),this.loadBitmapFont(R.fonts.robotoBold),this.loadPages(R.atlas.common),this.loadImage(R.images.bg.cristmas),this.loadEffect(R.effects.explosion),this.loadSound(R.sounds.winteryLoop),this.loadSound(R.sounds.click),this.loadSound(R.sounds.fall),this.loadSound(R.sounds.blast),this.loadSound(R.sounds.undoSwap),this.loadSound(R.sounds.gameover)};var Repository={};Repository.save=function(e,t){if(void 0!==localStorage){var i=JSON.stringify(t);localStorage.setItem(e,i)}},Repository.load=function(e){if(void 0!==localStorage){var t=localStorage.getItem(e);return JSON.parse(t)}},ScoreRepository.prototype.load=function(){var e=this.repository.load(this.REPO_SCORE_TAG);e&&(this.scores=e)},ScoreRepository.prototype.save=function(){try{this.repository.save(this.REPO_SCORE_TAG,this.scores)}catch(e){console.log("ScoreRepository.save Exception: "+e)}},ScoreRepository.prototype.getBestScores=function(){return this.scores.bestScores},ScoreRepository.prototype.getBest=function(){return this.scores.bestScores[0]||0},ScoreRepository.prototype.getLast=function(){return this.scores.last},ScoreRepository.prototype.saveScore=function(e){if(!(e<=0)){this.scores.last=e;var t=this.scores.bestScores;-1===t.indexOf(e)&&(t.push(e),t.sort(function(e,t){return t-e}),t.splice(this.BEST_SCORE_AMOUNT,t.length-this.BEST_SCORE_AMOUNT)),this.save()}};var Sound={SELECT:0,UNDO:1,FALL:2,BLAST:3,GAMEOVER:4,REPO_SETTINGS_TAG:"sound"};Sound.init=function(e,t){this.game=e,this.repository=t,this.music=e.add.sound(R.sounds.winteryLoop.name),this.sounds=[],this.sounds[this.SELECT]=e.add.sound(R.sounds.click.name),this.sounds[this.UNDO]=e.add.sound(R.sounds.undoSwap.name),this.sounds[this.BLAST]=e.add.sound(R.sounds.blast.name),this.sounds[this.FALL]=e.add.sound(R.sounds.fall.name),this.sounds[this.GAMEOVER]=e.add.sound(R.sounds.gameover.name),this.settings={mute:{all:!1,music:!1,sounds:!1},volume:{music:.3,sounds:1}},this.loadSettings()},Sound.loadSettings=function(){var e=this.repository.load(this.REPO_SETTINGS_TAG);e&&(this.settings=e)},Sound.saveSettings=function(){this.repository.save(this.REPO_SETTINGS_TAG,this.settings)},Sound.muteMusic=function(e){this.music.mute=e,this.settings.mute.music=e,this.music.isPlaying?this.music.stop():this.playMusic()},Sound.muteSounds=function(e){this.settings.mute.sounds=e,this.sounds.forEach(function(t){t.mute=e})},Sound.setMusicVolume=function(e){this.settings.volume.music=e,this.music.volume=e},Sound.setSoundsVolume=function(e){this.settings.volume.sounds=e,this.sounds.forEach(function(t){t.volume=e})},Sound.playMusic=function(){this.settings.mute.music||this.settings.mute.all||this.music.loopFull(this.settings.volume.music)},Sound.playSound=function(e){this.settings.mute.sounds||this.settings.mute.all||this.sounds[e].play("",0,this.settings.volume.sounds)};var JewelButtonType={SETTINGS:{shadow:R.images.buttons.bt75shadow,bg:R.images.buttons.bt75yellowbg,icon:R.images.buttons.bt75iconSettings},REPLAY:{shadow:R.images.buttons.bt75shadow,bg:R.images.buttons.bt75greenbg,icon:R.images.buttons.bt75iconReplay},SCORE:{shadow:R.images.buttons.bt75shadow,bg:R.images.buttons.bt75yellowbg,icon:R.images.buttons.bt75iconTrophy}};JewelButton.prototype.alignTo=function(e,t,i,s){return this.rootView.alignTo(e,t,i,s),this},JewelButton.prototype.alignIn=function(e,t,i,s){return this.rootView.alignIn(e,t,i,s),this},JewelButton.prototype.setXY=function(e,t){return this.rootView.x=e,this.rootView.y=t+this.SHADOW_Y_DELTA,this},JewelButton.prototype.setCallback=function(e,t){return this.globalCallback=e,this.globalContext=t,this},JewelButton.prototype.onInputDown=function(){this.bg.y=0,this.globalCallback&&this.globalCallback.apply(this.globalContext)},JewelButton.prototype.onInputUp=function(){this.bg.y=-this.SHADOW_Y_DELTA},JewelButton.prototype.hide=function(){this.rootView.kill()},JewelButton.prototype.show=function(){this.rootView.revive()};var ButtonBuilder={};ButtonBuilder.init=function(e){this.game=e},ButtonBuilder.newButton=function(e,t,i,s,o,n,a){return this.game.add.button(e,t,o,i,s,n,n,a,n)},ButtonBuilder.newTextButton=function(e,t,i,s,o,n,a,r,l){var h=this.newButton(e,t,i,s,o,n,a);return(r=this.game.add.bitmapText(0,0,R.fonts.robotoBold.name,r,l)).anchor.setTo(.5,.5),r.alignIn(h,Phaser.CENTER),h.addChild(r),h},ButtonBuilder.settingsButton=function(e,t,i,s){return new JewelButton(this.game,JewelButtonType.SETTINGS).setCallback(i,s).setXY(e,t)},ButtonBuilder.newGameButton=function(e,t,i,s){return new JewelButton(this.game,JewelButtonType.REPLAY).setCallback(i,s).setXY(e,t)},ButtonBuilder.scoreButton=function(e,t,i,s){return new JewelButton(this.game,JewelButtonType.SCORE).setCallback(i,s).setXY(e,t)},ButtonBuilder.hintButton=function(e,t,i,s){return this.newTextButton(e,t,i,s,R.images.buttons.midGreenIdle.page,R.images.buttons.midGreenIdle.name,R.images.buttons.midGreenPressed.name,Locale.strings.hintButton,32)},ButtonBuilder.restartGameOverButton=function(e,t,i,s){return this.newTextButton(e,t,i,s,R.images.buttons.bigGreenIdle.page,R.images.buttons.bigGreenIdle.name,R.images.buttons.bigGreenPressed.name,Locale.strings.gameoverRestartButton,32)},ButtonBuilder.bigGreenButton=function(e,t,i){return this.newTextButton(0,0,e,t,R.images.buttons.bigGreenIdle.page,R.images.buttons.bigGreenIdle.name,R.images.buttons.bigGreenPressed.name,i,32)},ButtonBuilder.backButton=function(e,t,i,s){return this.newTextButton(e,t,i,s,R.images.buttons.bigGreenIdle.page,R.images.buttons.bigGreenIdle.name,R.images.buttons.bigGreenPressed.name,Locale.strings.scoreBackButton,32)},Explosion.prototype.setXY=function(e,t){return this.rootView.x=e,this.rootView.y=t,this},Explosion.prototype.setOnObject=function(e){return this.rootView.alignIn(e,Phaser.CENTER),this},Explosion.prototype.play=function(){this.rootView.revive(),this.rootView.animations.play(this.ANIMATION_TAG,this.FRAME_RATE)},EffectManager.prototype.blast=function(e){var t,i,s,o,n,a=e.length;for(t=0;t<a;t++)for(n=(o=e[t]).length,i=0;i<n;i++)s=o[i],this.explosions[s.column][s.row].play()},StartPopup.prototype.show=function(){return this.rootView.revive(),this.game.world.bringToTop(this.rootView),this},StartPopup.prototype.hide=function(){return this.rootView.kill(),this},StartPopup.prototype.setXY=function(e,t){return this.rootView.x=e,this.rootView.y=t,this},StartPopup.prototype.onNewGamePressed=function(){this.hide(),this.newGameCallback&&this.newGameCallback.call(this.newGameCallbackContext)},StartPopup.prototype.setNewGameCallBack=function(e,t){return this.newGameCallback=e,this.newGameCallbackContext=t,this},StartPopup.prototype.addTitleLayout=function(){var e=this.game.add.image(0,0,R.images.ui.elkaBg.page,R.images.ui.elkaBg.name);e.alignIn(this.bg,Phaser.TOP_CENTER,0,-14),this.bg.addChild(e),this.titleText=this.game.add.bitmapText(0,0,R.fonts.robotoBold.name,Locale.strings.gameNameInLogo,48),this.titleText.align="center",this.titleText.alignIn(this.bg,Phaser.TOP_CENTER,0,-46),this.bg.addChild(this.titleText);var t=this.game.add.image(0,0,R.images.ui.snowTopping.page,R.images.ui.snowTopping.name);t.alignIn(this.bg,Phaser.TOP_CENTER,0,14),this.bg.addChild(t);var i=this.game.add.image(0,0,R.images.ui.santa.page,R.images.ui.santa.name);i.alignIn(this.bg,Phaser.BOTTOM_LEFT,-16,-14),this.bg.addChild(i)},StartPopup.prototype.addTutorialLayout=function(){var e=this.game.add.image(0,0,R.images.ui.tutorial01.page,R.images.ui.tutorial01.name);e.alignIn(this.bg,Phaser.RIGHT_CENTER,-28,0),this.bg.addChild(e);var t=this.game.add.bitmapText(0,0,R.fonts.robotoBold.name,Locale.strings.tutorial1text1,28);t.tint="0x1E396C",t.alignTo(e,Phaser.LEFT_TOP,24,-12),this.bg.addChild(t);var i=this.game.add.bitmapText(0,0,R.fonts.robotoBold.name,Locale.strings.tutorial1text2,28);i.tint="0x1E396C",i.align="right",i.alignTo(e,Phaser.BOTTOM_RIGHT,-12,12),this.bg.addChild(i)},GameOverPopup.prototype.alignIn=function(e,t,i,s){return this.rootView.alignIn(e,t,i,s),this},GameOverPopup.prototype.alignTo=function(e,t,i,s){return this.rootView.alignTo(e,t,i,s),this},GameOverPopup.prototype.show=function(e){return this.score=e||0,this.scoreText.setText(this.score),this.rootView.revive(),this.game.world.bringToTop(this.rootView),this.game.time.events.add(0,function(){this.scoreRepository.saveScore(e)},this),this},GameOverPopup.prototype.hide=function(){return this.rootView.kill(),this},GameOverPopup.prototype.setXY=function(e,t){return this.rootView.x=e,this.rootView.y=t,this},GameOverPopup.prototype.onNewGamePressed=function(){this.hide(),this.newGameCallback&&this.newGameCallback.call(this.newGameCallbackContext)},GameOverPopup.prototype.setNewGameCallBack=function(e,t){return this.newGameCallback=e,this.newGameCallbackContext=t,this},GameOverPopup.prototype.addLayout=function(){var e=this.game.add.image(0,0,R.images.ui.elkaBg.page,R.images.ui.elkaBg.name);e.alignIn(this.bg,Phaser.TOP_CENTER,0,-14),this.bg.addChild(e);var t=this.game.add.image(0,0,R.images.ui.snowTopping.page,R.images.ui.snowTopping.name);t.alignIn(this.bg,Phaser.TOP_CENTER,0,14),this.bg.addChild(t);var i=this.game.add.image(0,0,R.images.ui.scoreBg.page,R.images.ui.scoreBg.name);i.alignIn(this.bg,Phaser.CENTER,0,-42),this.bg.addChild(i),this.scoreText=this.game.add.bitmapText(0,0,R.fonts.fedoka.name,""+this.score,48),this.scoreText.tint="0xF9DC07",this.scoreText.anchor.set(.5,.5),this.scoreText.alignIn(i,Phaser.CENTER),this.bg.addChild(this.scoreText),this.scorePrefixText=this.game.add.bitmapText(0,0,R.fonts.robotoBold.name,Locale.strings.gameoverScorePrefix,38),this.scorePrefixText.tint="0x1E396C",this.scorePrefixText.anchor.set(.5,0),this.scorePrefixText.alignTo(i,Phaser.TOP_CENTER,0,24),this.bg.addChild(this.scorePrefixText),this.titleText=this.game.add.bitmapText(0,0,R.fonts.robotoBold.name,Locale.strings.gameoverTitle,48),this.titleText.align="center",this.titleText.alignIn(this.bg,Phaser.TOP_CENTER,0,-46),this.bg.addChild(this.titleText);var s=ButtonBuilder;this.startButton=s.restartGameOverButton(0,0,this.onNewGamePressed,this),this.startButton.alignIn(this.bg,Phaser.BOTTOM_CENTER,0,-32),this.bg.addChild(this.startButton)},SettingsPopup.prototype.show=function(){this.languageBtLabel.setText(Locale.getLocale().label),this.rootView.revive(),this.game.world.bringToTop(this.rootView)},SettingsPopup.prototype.hide=function(){Sound.saveSettings(),this.rootView.kill(),this.onHide()},SettingsPopup.prototype.setXY=function(e,t){return this.rootView.x=e,this.rootView.y=t,this},SettingsPopup.prototype.onLanguageButtonPressed=function(){this.hide(),this.languageCallback&&this.languageCallback.call(this.languageCallbackContext)},SettingsPopup.prototype.setLanguageCallBack=function(e,t){return this.languageCallback=e,this.languageCallbackContext=t,this},SettingsPopup.prototype.onHide=function(){this.onHideCallback&&this.onHideCallback.call(this.onHideCallbackContext)},SettingsPopup.prototype.setOnHideCallback=function(e,t){return this.onHideCallback=e,this.onHideCallbackContext=t,this},ScoreTablePopup.prototype.alignIn=function(e,t,i,s){return this.rootView.alignIn(e,t,i,s),this},ScoreTablePopup.prototype.alignTo=function(e,t,i,s){return this.rootView.alignTo(e,t,i,s),this},ScoreTablePopup.prototype.show=function(){var e=this.scoreRepository.getBestScores(),t=this.scoreRepository.getLast();return this.refreshScores(e,t),this.rootView.revive(),this.game.world.bringToTop(this.rootView),this},ScoreTablePopup.prototype.hide=function(){return this.rootView.kill(),this},ScoreTablePopup.prototype.setXY=function(e,t){return this.rootView.x=e,this.rootView.y=t,this},ScoreTablePopup.prototype.onBackPressed=function(){this.hide(),this.backCallback&&this.backCallback.call(this.backCallbackContext)},ScoreTablePopup.prototype.setBackCallBack=function(e,t){return this.backCallback=e,this.backCallbackContext=t,this},ScoreTablePopup.prototype.refreshScores=function(e,t){var i,s="",o=this.scoreRepository.BEST_SCORE_AMOUNT;for(i=0;i<o&&void 0!==e[i];i++)e[i],s+="\n"+e[i];this.scoreText.setText(s)},ScoreTablePopup.prototype.addLayout=function(){this.scoreBg=this.game.add.image(0,0,R.images.field.bg9.page,R.images.field.bg9.name),this.scoreBg.refresh9slice(320,400),this.scoreBg.alignIn(this.bg,Phaser.TOP_CENTER,0,-110),this.bg.addChild(this.scoreBg);var e=this.game.add.image(0,0,R.images.ui.elkaBg.page,R.images.ui.elkaBg.name);e.alignIn(this.bg,Phaser.TOP_CENTER,0,-14),this.bg.addChild(e);var t=this.game.add.image(0,0,R.images.ui.snowTopping.page,R.images.ui.snowTopping.name);t.alignIn(this.bg,Phaser.TOP_CENTER,0,14),this.bg.addChild(t),this.scoreText=this.game.add.bitmapText(0,0,R.fonts.fedoka.name,"",this.SCORE_FONT_SIZE),this.scoreText.anchor.setTo(.5,0),this.scoreText.align="center",this.scoreText.alignIn(this.bg,Phaser.TOP_CENTER,0,-100),this.bg.addChild(this.scoreText),this.titleText=this.game.add.bitmapText(0,0,R.fonts.robotoBold.name,Locale.strings.scoreTitle,48),this.titleText.alignIn(this.bg,Phaser.TOP_CENTER,0,-46),this.bg.addChild(this.titleText);var i=ButtonBuilder;this.backButton=i.backButton(0,0,this.onBackPressed,this),this.backButton.alignIn(this.bg,Phaser.BOTTOM_CENTER,0,32),this.bg.addChild(this.backButton)},LanguageMenuItem.prototype.alignIn=function(e,t,i,s){return this.rootView.alignIn(e,t,i,s),this},LanguageMenuItem.prototype.alignTo=function(e,t,i,s){return this.rootView.alignTo(e,t,i,s),this},LanguageMenuItem.prototype.show=function(){return this.rootView.revive(),this.game.world.bringToTop(this.rootView),this},LanguageMenuItem.prototype.hide=function(){return this.rootView.kill(),this},LanguageMenuItem.prototype.setXY=function(e,t){return this.rootView.x=e,this.rootView.y=t,this},LanguageMenuItem.prototype.setCallback=function(e,t){return this.globalCallback=e,this.globalContext=t,this},LanguageMenuItem.prototype.onInputDown=function(){this.globalCallback&&this.globalCallback.call(this.globalContext,this.locale)},LanguageMenuItem.prototype.select=function(e){this.cursorImage.alpha=e?1:0,this.textLabel.tint=e?this.SELECTED_TINT:this.DEFAULT_TINT},LanguagePopup.prototype.alignIn=function(e,t,i,s){return this.rootView.alignIn(e,t,i,s),this},LanguagePopup.prototype.alignTo=function(e,t,i,s){return this.rootView.alignTo(e,t,i,s),this},LanguagePopup.prototype.show=function(){return this.rootView.revive(),this.game.world.bringToTop(this.rootView),this},LanguagePopup.prototype.hide=function(){return this.rootView.kill(),this},LanguagePopup.prototype.setXY=function(e,t){return this.rootView.x=e,this.rootView.y=t,this},LanguagePopup.prototype.onOkButtonClick=function(){this.hide(),this.onHideCallback&&this.onHideCallback.call(this.onHideCallbackContext,this.selectedLocale)},LanguagePopup.prototype.setOnHideCallback=function(e,t){return this.onHideCallback=e,this.onHideCallbackContext=t,this},LanguagePopup.prototype.selectLocale=function(e){this.selectedLocale=e;var t=!1;this.menuGroup.forEach(function(i){t=i.menuItem.locale===e,i.menuItem.select(t)})},LanguagePopup.prototype.addLayout=function(){var e=this.game.add.image(0,0,R.images.ui.snowTopping.page,R.images.ui.snowTopping.name);e.alignIn(this.bg,Phaser.TOP_CENTER,0,14),this.bg.addChild(e);this.menuGroup=this.game.add.group();for(var t in this.localeManager.locales){var i=this.localeManager.locales[t];if(i&&i.label){var s=new LanguageMenuItem(this.game,i).setCallback(this.selectLocale,this);this.menuGroup.add(s.rootView)}}this.menuGroup.align(1,-1,0,56),this.menuGroup.alignIn(this.bg,Phaser.TOP_CENTER,0,-60),this.bg.addChild(this.menuGroup),this.selectLocale(Locale.currentLocale);var o=ButtonBuilder;this.startButton=o.bigGreenButton(this.onOkButtonClick,this,Locale.strings.ok),this.startButton.alignIn(this.bg,Phaser.BOTTOM_CENTER,0,28),this.bg.addChild(this.startButton)},VolumeSlider.prototype.setXY=function(e,t){return this.rootView.x=e,this.rootView.y=t,this},VolumeSlider.prototype.setVolumeCallback=function(e,t){return this.slider.setCallback(e,t),this},VolumeSlider.prototype.setCheckCallback=function(e,t){return this.checkCallback=e,this.checkCallbackContext=t,this};var JewelGenerator={JEWEL_SIZE:64,CURSOR_SIZE:66,colors:["#00FF00","#808080","#00FFFF","#0000CD","#DC143C","#FF00FF","#FFA500","#FFFF00"]};JewelGenerator.createJewel=function(e){e=Math.abs(e%this.colors.length);var t=this.colors[e];return ImageBuilder.rect(0,0,this.JEWEL_SIZE,this.JEWEL_SIZE,t)},JewelGenerator.changeJewelTexture=function(e,t){t=Math.abs(t%this.colors.length);var i=this.colors[t];e.loadTexture(ImageBuilder.rectTexture(this.JEWEL_SIZE,this.JEWEL_SIZE,i))},JewelGenerator.getCursor=function(){return ImageBuilder.strokeRect(0,0,this.CURSOR_SIZE,this.CURSOR_SIZE,"#00ffff",6)};var CristmasJewelGenerator={CURSOR_SIZE:68,imagePage:R.images.jewels.snow.page,images:[R.images.jewels.snow.name,R.images.jewels.sockGreen.name,R.images.jewels.candyMan.name,R.images.jewels.blueBall.name,R.images.jewels.sockPink.name,R.images.jewels.boxGift.name,R.images.jewels.candyHeart.name,R.images.jewels.jewelOrange.name,R.images.jewels.gloves.name,R.images.jewels.candyStick.name,R.images.jewels.candyRound.name,R.images.jewels.cap.name,R.images.jewels.star.name,R.images.jewels.snowFoot.name,R.images.jewels.ice.name,R.images.jewels.boxWood.name]};CristmasJewelGenerator.init=function(e){this.game=e},CristmasJewelGenerator.createJewel=function(e){e=Math.abs(e%this.images.length);var t=this.images[e];return this.game.add.image(100,100,this.imagePage,t)},CristmasJewelGenerator.changeJewelTexture=function(e,t){t=Math.abs(t%this.images.length),e.frameName=this.images[t]},CristmasJewelGenerator.getCursor=function(){return ImageBuilder.strokeRect(0,0,this.CURSOR_SIZE,this.CURSOR_SIZE,"#00ffff",6)},BejeweledGroup.prototype.refreshBgSize=function(){var e=this.width+this.FIELD_BG_PADDING+this.FIELD_BG_PADDING,t=this.height+this.FIELD_BG_PADDING+this.FIELD_BG_PADDING;this.bgImage.refresh9slice(e,t)},BejeweledGroup.prototype.setXY=function(e,t){return this.group.x=e,this.group.y=t,this.bgTilesGroup.alignIn(this.group,Phaser.CENTER),this.bgImage.alignIn(this.group,Phaser.CENTER),this},BejeweledGroup.prototype.alignIn=function(e,t,i,s){return this.group.alignIn(e,t,i,s),this.bgTilesGroup.alignIn(this.group,Phaser.CENTER),this.bgImage.alignIn(this.group,Phaser.CENTER),this},BejeweledGroup.prototype.alignTo=function(e,t,i,s){return this.group.alignTo(e,t,i,s),this.bgImage.alignIn(this.group,Phaser.CENTER),this},BejeweledGroup.prototype.onDown=function(e,t){this.isUiBlocked||this.isUiGlobalBlocked||e.model.type==JewelType.NONE||(this.swipe.start(t.x,t.y),this.presenter.onJewelClickDown(e.model))},BejeweledGroup.prototype.onUp=function(e){this.isUiBlocked||this.isUiGlobalBlocked||0!=this.swipe.check(e.x,e.y)&&this.presenter.onSwipe(this.swipe.direction)},BejeweledGroup.prototype.addJewelView=function(e){e.view=this.jewelGenerator.createJewel(e.type),e.view.x=e.column*this.GRID_STEP,e.view.y=e.row*this.GRID_STEP,e.view.model=e,this.bgTilesGroup.add(this.game.add.image(e.view.x,e.view.y,R.images.field.tileBg.page,R.images.field.tileBg.name)),this.group.add(e.view)},BejeweledGroup.prototype.setJewelViewType=function(e){this.jewelGenerator.changeJewelTexture(e.view,e.type)},BejeweledGroup.prototype.regenerateJewelView=function(e){this.setJewelViewType(e),this.game.add.tween(e.view).to({alpha:1},this.GRID_STEP_FALL_DURATION).delay(this.GRID_STEP_FALL_DURATION).start()},BejeweledGroup.prototype.showCursor=function(e){this.cursor.alignIn(e.view,Phaser.CENTER),this.cursor.x+=this.group.x,this.cursor.y+=this.group.y,this.cursor.revive()},BejeweledGroup.prototype.hideCursor=function(){this.cursor.kill()},BejeweledGroup.prototype.lockUi=function(){this.isUiBlocked=!0},BejeweledGroup.prototype.unlockUi=function(){this.isUiBlocked=!1},BejeweledGroup.prototype.lockUiGlobal=function(e){this.isUiGlobalBlocked=e},BejeweledGroup.prototype.makeSwapAnimation=function(e,t,i){void 0==i&&(i=!1),this.game.add.tween(e.view).to({x:t.view.x,y:t.view.y},this.SWAP_ANIMATION_DURATION,Phaser.Easing.Cubic.InOut).yoyo(i).start(),this.game.add.tween(t.view).to({x:e.view.x,y:e.view.y},this.SWAP_ANIMATION_DURATION,Phaser.Easing.Cubic.InOut).yoyo(i).start()},BejeweledGroup.prototype.makeFallingJewelView=function(e){this.game.add.tween(e.view).to({y:e.row*this.GRID_STEP},this.GRID_STEP_FALL_DURATION,Phaser.Easing.Cubic.InOut).start()},BejeweledGroup.prototype.makeBlastAnimation=function(e){this.game.add.tween(e.view).to({alpha:0},this.BLAST_ANIMATION_DURATION).to({y:0},1).start()},BejeweledGroup.prototype.makeHintAnimation=function(e,t){this.isUiBlocked||(this.lockUi(),this.game.add.tween(e.view).to({y:e.view.y-10},50).to({y:e.view.y+10},80).to({y:e.view.y},80).start(),this.game.add.tween(t.view).to({y:t.view.y-10},50).to({y:t.view.y+10},80).to({y:t.view.y},80).delay(225).start().onComplete.add(function(){this.unlockUi()},this))},BejeweledGroup.prototype.restart=function(){this.presenter.unselect(),this.presenter.generateLevel()},BejeweledGroup.prototype.showHint=function(e){this.isUiGlobalBlocked||this.isUiBlocked||this.presenter.showHint(e)},BejeweledGroup.prototype.hideHint=function(){this.presenter.unselect()},BejeweledGroup.prototype.getSolutionsAmount=function(){return this.presenter.solutions.length},BejeweledPresenter.prototype.generateLevel=function(){this.jewelLevel.fill(JewelType.getRandomCommon,JewelType),this.countAllCombos();do{this.jewelLevel.fill(JewelType.getRandomCommon,JewelType),this.countAllCombos(),0==this.combos.length&&(this.solutions=this.jewelLevel.getSolutions(this.COMBO_AMOUNT_MIN))}while(this.combos.length>0||0==this.solutions.length);this.jewelLevel.forEach(this.view.setJewelViewType.bind(this.view))},BejeweledPresenter.prototype.countAllCombos=function(){this.combos=this.jewelLevel.countGroups(this.COMBO_AMOUNT_MIN)},BejeweledPresenter.prototype.onJewelClickDown=function(e){e!=this.selectedJewel?this.hasSelection()&&this.jewelLevel.isNear(this.selectedJewel,e)?(this.isSwapAllowed(this.selectedJewel,e)&&this.swap(this.selectedJewel,e),this.unselect()):this.select(e):this.unselect()},BejeweledPresenter.prototype.onSwipe=function(e){if(this.hasSelection()){var t=this.jewelLevel.selectNearByDirection(this.selectedJewel,e);void 0!==t&&this.onJewelClickDown(t)}},BejeweledPresenter.prototype.select=function(e){this.selectedJewel=e,this.view.showCursor(e),this.view.callbacks.select(e)},BejeweledPresenter.prototype.unselect=function(){this.view.hideCursor(),this.selectedJewel=void 0},BejeweledPresenter.prototype.hasSelection=function(){return void 0!==this.selectedJewel},BejeweledPresenter.prototype.isSwapAllowed=function(e,t){return e.type!==t.type},BejeweledPresenter.prototype.swap=function(e,t){this.view.lockUi(),this.jewelLevel.swap(e,t),this.countAllCombos(),this.view.callbacks.swap(e,t,this.combos.length>0),0==this.combos.length?(this.jewelLevel.swap(e,t),this.view.makeSwapAnimation(e,t,!0),this.callWithDelay(function(){this.view.unlockUi()},this,2*this.view.SWAP_ANIMATION_DURATION)):(this.view.makeSwapAnimation(e,t),this.callWithDelay(this.blastCombos,this,this.view.SWAP_ANIMATION_DURATION))},BejeweledPresenter.prototype.checkCombos=function(){this.countAllCombos(),this.combos.length>0?this.blastCombos():(this.view.unlockUi(),this.solutions=this.jewelLevel.getSolutions(this.COMBO_AMOUNT_MIN),0==this.solutions.length&&this.view.callbacks.noMoves())},BejeweledPresenter.prototype.showHint=function(e){this.solutions=this.jewelLevel.getSolutions(this.COMBO_AMOUNT_MIN),this.solutions.length>0&&(e&&this.solutions.sort(function(e,t){return t.length-e.length}),this.view.makeHintAnimation(this.solutions[0].hint,this.solutions[0].target),this.view.callbacks.hintShown(this.solutions[0]))},BejeweledPresenter.prototype.blastCombos=function(){var e,t,i,s=this.combos.length;for(this.view.callbacks.blastStart(this.combos),e=0;e<s;e++)for(i=this.combos[e].length,t=0;t<i;t++)this.combos[e][t].type=JewelType.NONE,this.view.makeBlastAnimation(this.combos[e][t]);this.callWithDelay(function(){this.view.callbacks.totalBlastFinish(),this.tryNextFall()},this,this.view.BLAST_ANIMATION_DURATION)},BejeweledPresenter.prototype.tryNextFall=function(){var e,t,i,s,o,n=this.jewelLevel.cols-1,a=this.jewelLevel.rows,r=!1;for(o=0;o<=n;o++)for(i=!1,s=a-1;s>=0;s--)(e=this.jewelLevel.jewels[o][s]).type!==JewelType.NONE?i&&(t=this.jewelLevel.jewels[o][s+1],this.jewelLevel.swap(e,t),r=!0,this.view.makeFallingJewelView(e),this.view.callbacks.singleFallStart(e)):(i=!0,0==s&&(r=!0,e.type=JewelType.getRandomCommon(),this.view.regenerateJewelView(e),this.view.callbacks.singleBornStart(e),this.callWithDelay(function(){this.view.callbacks.singleFallFinish(e)},this,this.view.GRID_STEP_FALL_DURATION)));r?this.callWithDelay(this.tryNextFall,this,this.view.GRID_STEP_FALL_DURATION):this.callWithDelay(this.checkCombos,this,this.view.GRID_STEP_FALL_DURATION)},BejeweledPresenter.prototype.callWithDelay=function(e,t,i,s,o,n){this.view.game.time.events.add(i,e,t,s,o,n)};var States={PRELOADER:"preloader",START_SCREEN:"startScreen"};UiTextButton.prototype.refreshPressedXY=function(){this.idleY=this.bg.y,this.pressedY=this.bg.y+this.PRESSED_Y_DELTA},UiTextButton.prototype.alignTo=function(){return this.bg.alignTo.apply(this.bg,arguments),this.refreshPressedXY(),this},UiTextButton.prototype.alignIn=function(){return this.bg.alignIn.apply(this.bg,arguments),this.refreshPressedXY(),this},UiTextButton.prototype.setXY=function(e,t){return this.bg.x=e,this.bg.y=t,this.refreshPressedXY(),this},UiTextButton.prototype.setCallback=function(e,t){return this.globalCallback=e,this.globalContext=t,this},UiTextButton.prototype.onInputDown=function(){this.overlay.revive(),this.bg.y=this.pressedY,this.globalCallback&&this.globalCallback.apply(this.globalContext)},UiTextButton.prototype.onInputUp=function(){this.bg.y=this.idleY,this.overlay.kill()},UiTextButton.prototype.kill=function(){this.bg.kill()},UiTextButton.prototype.revive=function(){this.bg.revive()},PreloaderImage.prototype.loadUpdate=function(){this.percent=this.game.load.progress,this.progressImage.scale.x=this.percent/100,this.progressGlowImage.scale.x=this.percent/100},ScoreLogic.prototype.onNewGame=function(){this.score=0,this.bestScore=this.scoreRepository.getBest()},ScoreLogic.prototype.onHint=function(e){this.score-=this.HINT_SCORE_PRICE,this.score<0&&(this.score=0)},ScoreLogic.prototype.onCombo=function(e){this.score+=this.SCORE_JEWEL*e.length;for(var t=e.length-this.SCORE_COMBO_MIN,i=this.SCORE_EXTRA_COMBO_BONUS,s=0;s<t;s++)this.score+=i,i+=this.SCORE_EXTRA_COMBO_BONUS},ScoreLogic.prototype.getBestScoreText=function(){return Locale.strings.bestScorePrefix+this.bestScore};var startScreenNotShowed=!0,PhaserConfig={settings:{width:AppConfig.width,height:AppConfig.height,renderer:Phaser.CANVAS,transparent:!1,enableDebug:!1,scaleMode:Phaser.ScaleManager.SHOW_ALL},exe:function(e){e.scale.pageAlignHorizontally=!0,e.scale.pageAlignVertically=!0,e.input.maxPointers=1,e.renderer.renderSession.roundPixels=!0,e.tweens.frameBased=!1,e.time.advancedTiming=!1,e.forceSingleUpdate=!0}},App=function(e){var t,i=new Phaser.Game(PhaserConfig.settings),s=0,o=e.length;for(s=0;s<o;s++)t=e[s],i.state.add(t.name,t.state);i.state.start(States.PRELOADER)};new App([{name:States.PRELOADER,state:new Preloader(AssetLoader)},{name:States.START_SCREEN,state:new MainState}]);